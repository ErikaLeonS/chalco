<!DOCTYPE html>
<html>
<head>
    <title>Mapa con Fotos en Leaflet</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Incluye el CSS de Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 600px; }
    </style>
</head>
<body>
    <div id="map"></div>

    <!-- Incluye el JavaScript de Leaflet y EXIF.js -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

    <script>
        // Inicializa el mapa
        var map = L.map('map').setView([19.4326, -99.1332], 10); // Usa coordenadas de ejemplo (Ciudad de México)

        // Añade una capa de mapas de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
        }).addTo(map);

        // Ruta de la carpeta de fotos en GitHub
        var fotosCarpeta = 'https://raw.githubusercontent.com/usuario/repositorio/rama/fotos_rec_23082024/'; // Cambia esto a tu URL de GitHub

        // Número total de fotos
        var totalFotos = 148;

        // Función para convertir grados, minutos y segundos a decimal
        function convertirDMSToDD(grados, minutos, segundos, direccion) {
            var dd = grados + minutos/60 + segundos/(60*60);
            if (direccion == "S" || direccion == "W") {
                dd = dd * -1; 
            }
            return dd;
        }

        // Cargar las fotos y extraer las coordenadas utilizando un bucle
        for (var num = 1; num <= totalFotos; num++) { // Itera sobre todas las fotos
            (function(num) { // Usamos una IIFE para capturar el valor de 'num'
                var fotoUrl = fotosCarpeta + '1 (' + num + ').jpg'; // Construye el nombre de archivo
                var img = new Image();
                img.src = fotoUrl;

                img.onload = function() {
                    EXIF.getData(img, function() {
                        var latitud = EXIF.getTag(this, "GPSLatitude");
                        var latitudRef = EXIF.getTag(this, "GPSLatitudeRef");
                        var longitud = EXIF.getTag(this, "GPSLongitude");
                        var longitudRef = EXIF.getTag(this, "GPSLongitudeRef");

                        if (latitud && longitud) {
                            var lat = convertirDMSToDD(latitud[0], latitud[1], latitud[2], latitudRef);
                            var lon = convertirDMSToDD(longitud[0], longitud[1], longitud[2], longitudRef);
                            
                            // Añadir marcador al mapa
                            var marker = L.marker([lat, lon]).addTo(map);
                            marker.bindPopup('<img src="' + fotoUrl + '" width="150" height="150"/>');
                        } else {
                            console.error('No se encontraron datos GPS en:', fotoUrl);
                        }
                    });
                };

                img.onerror = function() {
                    console.error('Error al cargar la foto:', fotoUrl);
                };
            })(num); // IIFE para capturar el valor actual de 'num'
        }
    </script>
</body>
</html>

